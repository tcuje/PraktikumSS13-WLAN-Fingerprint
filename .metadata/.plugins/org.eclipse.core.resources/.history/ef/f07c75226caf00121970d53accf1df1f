package de.rwth.ti;

import android.app.Activity;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.IntentFilter;
import android.net.wifi.WifiManager;
import android.net.wifi.WifiManager.WifiLock;

public class ScanManager {

	Activity app;
	WifiManager wifi;
	WifiLock wl;
	BroadcastReceiver receiver;

	public ScanManager(Activity app) {
		// Setup WiFi
		wifi = (WifiManager) app.getSystemService(Context.WIFI_SERVICE);
		wl = wifi.createWifiLock("Wavi");

		// Register Broadcast Receiver
		if (receiver == null) {
			receiver = new ScanReceiver(app);
		}

	}

	public void start() {
		app.registerReceiver(receiver, new IntentFilter(
				WifiManager.SCAN_RESULTS_AVAILABLE_ACTION));
		wl.acquire();
	}

	public void stop() {
		try {
			app.unregisterReceiver(receiver);
		} catch (IllegalArgumentException ex) {
			// just ignore it
		}
		wl.release();
	}

	public void startSingleScan() {
		wifi.startScan();
	}

}
